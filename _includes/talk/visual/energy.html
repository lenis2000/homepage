<section class="slide slide-top" id="energy" data-title="Energy">
    <h2 class="slide-title">Local energy</h2>

    <div style="display: grid; grid-template-columns: 0.8fr 1.2fr; gap: 2vw; margin-top: 1vh; width: 100%; align-items: start;">
        <!-- Left: Text explanation -->
        <div style="display: flex; flex-direction: column; gap: 1.5vh; font-size: clamp(1.2rem, 2.2vw, 1.8rem);">
            <!-- How to get limit shape -->
            <div style="background: #f5f5f5; border-left: 4px solid var(--slide-accent); padding: 1vh 1.5vw; text-align: left;">
                <strong style="color: var(--slide-accent);">How to get limit shape?</strong>
                <ul style="margin: 0.5vh 0 0 1.5em; padding: 0;">
                    <li>Approximate any surface by piecewise-planar patches</li>
                    <li>Count configurations approximating a given slope \((A,B)\)</li>
                    <li>Integrate and maximize to get the typical shape</li>
                </ul>
            </div>

            <!-- CKP 2000 -->
            <div style="background: #f5f5f5; border-left: 4px solid var(--slide-accent); padding: 1vh 1.5vw; text-align: left;">
                <strong style="color: var(--slide-accent);">Energy Ïƒ(A,B) [Cohn-Kenyon-Propp 2000]</strong><br>
                    \(\sigma(A,B) = \dfrac1\pi
                    ( L(\pi p_1)+L(\pi p_2)+L(\pi (1-p_1-p_2))),
                    \)
                    where \(p_1, p_2, 1-p_1-p_2\) is the normal direction to the patch, and <br>
                    \(
                    L(z)=\int_0^z\log|2\sin t|\,dt
                    \) is the Lobachevsky function.
            </div>

            <!-- Integral -->
            <div style="background: #f5f5f5; border-left: 4px solid var(--slide-accent); padding: 1vh 1.5vw; text-align: left;">
                <strong style="color: var(--slide-accent);">Variational principle, subject to boundary conditions</strong><br>
                Limit shape $z=h(x,y)$ maximizes \(\displaystyle\iint \sigma(\nabla h)\, dxdy\)
            </div>

            <!-- KOS 2006 -->
            <div style="background: #f5f5f5; border-left: 4px solid var(--slide-accent); padding: 1vh 1.5vw; text-align: left;">
                <strong style="color: var(--slide-accent);">Generalization [Kenyon-Okounkov-Sheffield 2006]</strong><br>
                Our surfaces use \(1\times 1\) squares in three coordinate directions.
                The theory of limit shapes generalizes
                to surfaces from plaquettes of other shapes, possibly weighted.
                Local energy expressed through <b>algebraic geometry</b> of the plaquettes.
            </div>
        </div>

        <!-- Right: 3D tiling canvas -->
        <div style="position: relative; display: flex; flex-direction: column; align-items: center; gap: 1vh;">
            <!-- 3D tiling canvas (main) -->
            <canvas id="energy-tiling-canvas" width="1200" height="1000" style="height: 80vh; width:47vw; border: 1px solid #ccc;"></canvas>
            <!-- Controls below -->
            <div id="energy-controls" style="display: flex; gap: 1vw; align-items: center; flex-wrap: wrap; font-size: clamp(0.75rem, 1.5vw, 1.1rem);">
                <label style="display: flex; align-items: center; gap: 0.3vw;">
                    A: <input type="number" id="gradient-a" min="-5" max="5" step="0.1" value="-2" style="width: 4em; font-size: inherit; padding: 0.2em;">
                </label>
                <label style="display: flex; align-items: center; gap: 0.3vw;">
                    B: <input type="number" id="gradient-b" min="-5" max="5" step="0.1" value="0.3" style="width: 4em; font-size: inherit; padding: 0.2em;">
                </label>
                <button id="energy-sample" style="padding: 0.3em 0.6em; cursor: pointer; border: 2px solid var(--slide-accent); background: var(--slide-accent); color: white; border-radius: 4px; font-size: inherit;">Sample</button>
                <span style="color: #888; margin-left: 0.5vw;">plane z=Ax+By</span>
            </div>
        </div>
    </div>
</section>
