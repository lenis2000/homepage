<!-- APPROVED: Do not modify without explicit user request -->
<section class="slide slide-top" id="energy" data-title="Local Patches">
    <h2 class="slide-title">Local Patches</h2>

    <div style="display: grid; grid-template-columns: 0.8fr 1.2fr; gap: 2vw; margin-top: 1vh; width: 100%; align-items: start;">
        <!-- Left: Text explanation -->
        <div style="display: flex; flex-direction: column; gap: 1.5vh; font-size: clamp(1.5rem, 2.5vw, 2rem);">
            <!-- How to get limit shape -->
            <div style="background: #f5f5f5; border-left: 4px solid var(--slide-accent); padding: 1.5vh 1.5vw; text-align: left;">
                <strong style="color: var(--slide-accent);">Local patches:</strong>
                <ul style="margin: 0.5vh 0 0 1.5em; padding: 0;">
                    <li>Approximate the surface by piecewise-planar patches</li>
                    <li>Each patch is a <strong>flat random surface</strong> with a given slope \((s_1, s_2)\)</li>
                    <li>For a given slope, the number of approximating 3D surfaces is \(\approx e^{N^2\cdot \sigma(s_1,s_2) }\)</li>
                </ul>
            </div>

            <!-- Variational principle -->
            <div style="background: #e3f2fd; border-left: 4px solid var(--slide-navy); padding: 1.5vh 1.5vw; text-align: left;">
                <strong style="color: var(--slide-navy);">Variational principle</strong> <span style="color: var(--slide-muted);">[Cohn–Kenyon–Propp 2000]</span><strong style="color: var(--slide-navy);">:</strong><br>
                Limit shape \(z=h(x,y)\) maximizes
                \[\displaystyle\iint \sigma(\nabla h)\, dxdy\]
                subject to boundary conditions on \(h(x,y)\)
            </div>

            <!-- Sigma formula -->
            <div style="font-size: clamp(1.2rem, 2vw, 1.6rem); color: var(--slide-muted); text-align: left; margin-top: 0.5vh;">
                \(\sigma(s_1,s_2) = \tfrac{1}{\pi}\bigl[\Lambda(\pi s_1) + \Lambda(\pi s_2) + \Lambda(\pi (1\!-\!s_1\!-\!s_2))\bigr]\)
                <div style="height: 1.4em;"></div>
                    \(\Lambda(\theta)=-\!\int_0^\theta \ln|2\sin t|\,dt\) &ensp; <strong>(Lobachevsky function)</strong>
            </div>

        </div>

        <!-- Right: 3D tiling canvas -->
        <div style="position: relative; display: flex; flex-direction: column; align-items: center; gap: 1vh;">
            <!-- Text above canvas -->
            <div style="font-size: clamp(0.96rem, 1.76vw, 1.44rem); text-align: center;">
                Other 3D building blocks besides squares of three directions: <span style="color: var(--slide-muted);">[Kenyon–Okounkov–Sheffield 2006]</span>
            </div>
            <!-- 3D tiling canvas (main) -->
            <canvas id="energy-tiling-canvas" width="1200" height="1000" style="height: 70vh; width:44vw; border: 1px solid #ccc;"></canvas>
            <!-- Controls below -->
            <div id="energy-controls" style="display: flex; gap: 1vw; align-items: center; flex-wrap: wrap; font-size: clamp(1rem, 1.8vw, 1.4rem);">
                <label style="display: flex; align-items: center; gap: 0.3vw;">
                    A: <input type="number" id="gradient-a" min="-5" max="5" step="0.1" value="-2" style="width: 4em; font-size: inherit; padding: 0.2em;">
                </label>
                <label style="display: flex; align-items: center; gap: 0.3vw;">
                    B: <input type="number" id="gradient-b" min="-5" max="5" step="0.1" value="0.3" style="width: 4em; font-size: inherit; padding: 0.2em;">
                </label>
                <button id="energy-sample" style="padding: 0.3em 0.6em; cursor: pointer; border: 2px solid var(--slide-accent); background: var(--slide-accent); color: white; border-radius: 4px; font-size: inherit;">Sample</button>
                <span style="color: #888; margin-left: 0.5vw;">plane z=Ax+By</span>
            </div>
        </div>
    </div>
</section>
